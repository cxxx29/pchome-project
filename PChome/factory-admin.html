<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合光同程 · 生产管理端</title>
    <meta name="description" content="合光同程PC端生产管理：任务看板、数据看板、工厂资源库、报价/打样/订单/发货/结算。">
    <link rel="stylesheet" href="./factory-admin.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect x='0' y='0' width='100' height='100' rx='14' fill='%230052D9'/><text x='50' y='62' font-size='44' text-anchor='middle' fill='white'>HG</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
    <header class="topbar">
        <div class="topbar-inner">
            <div class="left">
                <span class="logo">合光同程</span>
                <div class="event-select">
                    <button id="event-btn">当前赛事：2025主赛事 ▾</button>
                    <div class="event-menu" id="event-menu">
                        <button data-event="2025主赛事">2025主赛事</button>
                        <button data-event="城市IP">城市IP</button>
                        <button data-event="高校挑战">高校挑战</button>
                    </div>
                </div>
            </div>
            <div class="right">
                <div class="bell" id="bell"><span>🔔</span><i id="bell-badge">3</i></div>
                <div class="avatar" id="avatar">
                    <img alt="admin" src="https://api.dicebear.com/7.x/identicon/svg?seed=factory-admin"/>
                    <div class="menu" id="avatar-menu">
                        <button data-action="profile">个人中心</button>
                        <button data-action="logout">退出</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="layout">
        <aside class="sider">
            <nav class="menu">
                <button class="item is-active" data-route="tasks">1 任务看板</button>
                <button class="item" data-route="dashboard">2 数据看板</button>
                <button class="item" data-route="repo">3 工厂资源库</button>
                <button class="item" data-route="quote">4 报价管理</button>
                <button class="item" data-route="sample">5 打样管理</button>
                <button class="item" data-route="orders">6 订单管理</button>
                <button class="item" data-route="shipping">7 发货管理</button>
                <button class="item" data-route="funds">8 资金结算</button>
            </nav>
        </aside>

        <main class="workspace">
            <!-- 任务看板 -->
            <section id="view-tasks" class="view is-active">
                <div class="cards">
                    <button class="card" data-jump="quote" data-key="status" data-value="待处理"><div class="name">待处理报价</div><div class="val">12</div><div class="hint">立即处理</div></button>
                    <button class="card" data-jump="sample" data-key="status" data-value="待处理"><div class="name">待处理打样</div><div class="val">8</div><div class="hint">立即处理</div></button>
                    <button class="card" data-jump="orders" data-key="status" data-value="待处理"><div class="name">待处理订单</div><div class="val">34</div><div class="hint">立即处理</div></button>
                    <button class="card" data-jump="orders" data-key="status" data-value="待交付"><div class="name">待交付</div><div class="val">5</div><div class="hint">立即处理</div></button>
                </div>
                <div class="task-grid">
                    <div class="card-plot">
                        <div class="title">任务趋势（30天）</div>
                        <div id="chart-trend" class="chart"></div>
                    </div>
                    <div class="card-plot">
                        <div class="title">本周供应链 KPI</div>
                        <div id="chart-kpi" class="chart"></div>
                    </div>
                </div>
            </section>

            <!-- 数据看板 -->
            <section id="view-dashboard" class="view">
                <div class="toolbar">
                    <select id="range"><option>近7天</option><option selected>近30天</option><option>近90天</option></select>
                    <select id="event"><option>全部赛事</option><option>2025主赛事</option><option>城市IP</option></select>
                    <button class="btn" id="btn-refresh">刷新</button>
                    <button class="btn" id="btn-export">导出</button>
                </div>
                <div class="kpi-strip">
                    <div class="kpi"><span>总报价数</span><b id="k-quote">45</b></div>
                    <div class="kpi"><span>总订单数</span><b id="k-order">32</b></div>
                    <div class="kpi"><span>生产中订单</span><b id="k-in">18</b></div>
                    <div class="kpi"><span>完成订单</span><b id="k-done">14</b></div>
                    <div class="kpi"><span>次品率</span><b id="k-defect">0.8%</b></div>
                </div>
                <div class="charts-3">
                    <div id="chart-stacked" class="chart"></div>
                    <div id="chart-capacity" class="chart"></div>
                    <div id="chart-status" class="chart"></div>
                </div>
            </section>

            <!-- 工厂资源库 -->
            <section id="view-repo" class="view">
                <div class="toolbar">
                    <input class="input" placeholder="搜索工厂名称">
                    <select><option>全部地区</option><option>华东</option><option>华南</option><option>华北</option></select>
                    <select><option>全部工艺</option><option>刺绣</option><option>缝纫</option><option>充棉</option></select>
                    <select><option>状态</option><option>待审核</option><option>已入驻</option></select>
                    <button class="btn" id="btn-add-factory">+ 添加工厂</button>
                </div>
                <div class="table" id="repo-table"></div>
                <div class="drawer" id="repo-audit" aria-hidden="true"></div>
            </section>

            <!-- 报价管理 -->
            <section id="view-quote" class="view">
                <div class="kanban" id="quote-kanban">
                    <div class="col" data-col="todo"><div class="col-title">待审核图纸</div><div class="col-body"></div></div>
                    <div class="col" data-col="dispatch"><div class="col-title">分发报价中</div><div class="col-body"></div></div>
                    <div class="col" data-col="compare"><div class="col-title">待比价确认</div><div class="col-body"></div></div>
                    <div class="col" data-col="confirmed"><div class="col-title">已确认</div><div class="col-body"></div></div>
                    <div class="col" data-col="rejected"><div class="col-title">已拒绝</div><div class="col-body"></div></div>
                </div>
                <div class="drawer" id="drawing-audit" aria-hidden="true"></div>
                <div class="modal" id="dispatch-modal" aria-hidden="true"></div>
            </section>

            <!-- 占位：打样、订单、发货、资金 -->
            <section id="view-sample" class="view"><div class="placeholder">打样管理（占位）</div></section>
            <section id="view-orders" class="view"><div class="placeholder">订单管理（占位）</div></section>
            <section id="view-shipping" class="view"><div class="placeholder">发货管理（占位）</div></section>
            <section id="view-funds" class="view"><div class="placeholder">资金与结算（占位）</div></section>
        </main>
    </div>

    <script>
    (function(){
        // 简易路由
        const routes=['tasks','dashboard','repo','quote','sample','orders','shipping','funds'];
        function go(name){
            document.querySelectorAll('.view').forEach(v=>v.classList.remove('is-active'));
            document.getElementById('view-'+name)?.classList.add('is-active');
            document.querySelectorAll('.menu .item').forEach(i=>i.classList.toggle('is-active', i.getAttribute('data-route')===name));
            history.replaceState(null,'','#'+name);
        }
        document.querySelectorAll('.menu .item').forEach(i=>i.addEventListener('click',()=>go(i.getAttribute('data-route'))));
        go(routes.includes(location.hash.replace('#',''))?location.hash.replace('#',''):'tasks');

        // 顶部事件下拉
        const evtBtn=document.getElementById('event-btn'); const evtMenu=document.getElementById('event-menu');
        evtBtn.addEventListener('click',()=>evtMenu.classList.toggle('open'));
        evtMenu.addEventListener('click',(e)=>{ const btn=e.target.closest('button'); if(!btn) return; evtBtn.textContent='当前赛事：'+btn.dataset.event+' ▾'; evtMenu.classList.remove('open'); });
        document.addEventListener('click',(e)=>{ if(!evtMenu.contains(e.target)&&e.target!==evtBtn) evtMenu.classList.remove('open'); });

        // 头像菜单
        const avatar=document.getElementById('avatar');
        avatar.addEventListener('click',()=>avatar.classList.toggle('open'));
        document.addEventListener('click',(e)=>{ if(!avatar.contains(e.target)) avatar.classList.remove('open'); });

        // 任务卡跳转（新标签页模拟）
        document.querySelectorAll('#view-tasks .cards .card').forEach(c=>{
            c.addEventListener('click',()=>{
                const jump=c.getAttribute('data-jump');
                go(jump);
                // 可在目标页渲染筛选chip；此处为占位
            });
        });

        // 图表：任务趋势 + KPI 仪表
        const trend=echarts.init(document.getElementById('chart-trend'));
        const kpi=echarts.init(document.getElementById('chart-kpi'));
        const days=Array.from({length:30},(_,i)=>{const d=new Date(); d.setDate(d.getDate()-(29-i)); return `${d.getMonth()+1}/${d.getDate()}`;});
        trend.setOption({ grid:{left:40,right:12,top:18,bottom:24}, tooltip:{trigger:'axis'}, legend:{data:['报价','打样','订单']}, xAxis:{type:'category',data:days}, yAxis:{type:'value'}, series:[{name:'报价',type:'line',smooth:true,areaStyle:{opacity:.12},data:days.map(()=>~~(5+Math.random()*20)), itemStyle:{color:'#0052D9'}},{name:'打样',type:'line',smooth:true,areaStyle:{opacity:.12},data:days.map(()=>~~(2+Math.random()*12)), itemStyle:{color:'#2BA471'}},{name:'订单',type:'line',smooth:true,areaStyle:{opacity:.12},data:days.map(()=>~~(3+Math.random()*15)), itemStyle:{color:'#ED7B2F'}}] });
        kpi.setOption({ series:[{ type:'gauge', startAngle:200, endAngle:-20, min:0, max:100, splitNumber:4, axisLine:{ lineStyle:{ width:10, color:[[0.3,'#ED7B2F'],[0.7,'#0052D9'],[1,'#2BA471']] }}, pointer:{ show:true, icon:'rect', length:'60%', width:6 }, axisTick:{ show:false }, splitLine:{ show:false }, axisLabel:{ color:'#9db3d8' }, detail:{ valueAnimation:true, formatter:'{value}%', color:'#fff' }, data:[{ value: 76, name: '产能KPI' }] }] });

        // 数据看板图表
        const stacked=echarts.init(document.getElementById('chart-stacked'));
        const capacity=echarts.init(document.getElementById('chart-capacity'));
        const status=echarts.init(document.getElementById('chart-status'));
        function renderDashboard(){
            const x=Array.from({length:12},(_,i)=>`${i+1}月`);
            stacked.setOption({ tooltip:{trigger:'axis'}, legend:{data:['报价-数量','订单-数量','交付-金额']}, xAxis:{type:'category',data:x}, yAxis:[{type:'value',name:'数量'},{type:'value',name:'金额', position:'right'}], series:[{ name:'报价-数量', type:'line', stack:'qty', areaStyle:{}, data:x.map(()=>~~(60+Math.random()*40)), yAxisIndex:0, itemStyle:{color:'#0052D9'} },{ name:'订单-数量', type:'line', stack:'qty', areaStyle:{}, data:x.map(()=>~~(40+Math.random()*30)), yAxisIndex:0, itemStyle:{color:'#2BA471'} },{ name:'交付-金额', type:'bar', data:x.map(()=>~~(200+Math.random()*120)), yAxisIndex:1, itemStyle:{color:'#ED7B2F'} }]});
            capacity.setOption({ grid:{left:60,right:16,top:18,bottom:24}, tooltip:{trigger:'axis'}, xAxis:{type:'value'}, yAxis:{type:'category',data:['工厂A','工厂B','工厂C','工厂D','工厂E']}, series:[{ type:'bar', data:[86,72,64,58,40], itemStyle:{color:'#0052D9'} }]});
            status.setOption({ tooltip:{trigger:'item'}, series:[{ type:'pie', radius:['45%','70%'], label:{ formatter:'{b}: {c} ({d}%)' }, data:[{value:8,name:'待生产'},{value:18,name:'生产中'},{value:6,name:'待验收'},{value:4,name:'已发货'},{value:12,name:'已完成'}] }]});
        }
        renderDashboard();
        window.addEventListener('resize',()=>{ trend.resize(); kpi.resize(); stacked.resize(); capacity.resize(); status.resize(); });
    })();
    </script>
</body>
</html>


